<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>瀑布流</title>
</head>
<style>
.waterfall{

    
}
.waterfall>img{
    width: 100px;
    margin: 10px;
    position: absolute;
    
}
</style>
<body>
    <div class="waterfall">
        <img src="https://via.placeholder.com/100x100" alt="300*100">
        <img src="https://via.placeholder.com/100x80" alt="300*80">
        <img src="https://via.placeholder.com/100x110" alt="300*110">
        <img src="https://via.placeholder.com/100x90" alt="300*90">
        <img src="https://via.placeholder.com/100x60" alt="300*60">
        <img src="https://via.placeholder.com/100x150" alt="300*150">
        <img src="https://via.placeholder.com/100x180" alt="300*180">
        <img src="https://via.placeholder.com/100x80" alt="300*80">
        <img src="https://via.placeholder.com/100x130" alt="300*130">
        <img src="https://via.placeholder.com/100x70" alt="300*70">
        <img src="https://via.placeholder.com/100x50" alt="300*50">
        <img src="https://via.placeholder.com/100x110" alt="300*110">
        <img src="https://via.placeholder.com/100x50" alt="300*50">
        <img src="https://via.placeholder.com/100x60" alt="300*60">
        <img src="https://via.placeholder.com/100x40" alt="300*40">
        <img src="https://via.placeholder.com/100x200" alt="300*200">
        <img src="https://via.placeholder.com/100x60" alt="300*60">
        <img src="https://via.placeholder.com/100x150" alt="300*150">
        <img src="https://via.placeholder.com/100x180" alt="300*180">
        <img src="https://via.placeholder.com/100x80" alt="300*80">
        <img src="https://via.placeholder.com/100x130" alt="300*130">
        <img src="https://via.placeholder.com/100x70" alt="300*70">
        <img src="https://via.placeholder.com/100x50" alt="300*50">
        <img src="https://via.placeholder.com/100x110" alt="300*110">
        <img src="https://via.placeholder.com/100x70" alt="300*70">
        <img src="https://via.placeholder.com/100x160" alt="300*160">
        <img src="https://via.placeholder.com/100x210" alt="300*210">
    </div>
</body>
<script>
/*         var waterfall = {
      init: function(){
        
        this.colHeightArray = []
        this.imgWidth = $('.waterfall img').outerWidth(true)
        this.colCount =  Math.floor($('.waterfall').width()/this.imgWidth)
        for(var i=0; i<this.colCount; i++){
          this.colHeightArray[i] = 0
        }
        this.bind()
      },
      bind: function(){
        var _this = this
        $('.waterfall img').on('load', function(){
          _this.layout($(this))
        })
        $(window).on('resize', function(){
          $('.waterfall img').each(function(){
            _this.layout($(this))
          })
        })
      },
      layout: function($node){
        console.log(this)
        var minValue = this.colHeightArray[0] //0
        var minIndex = 0   //0
console.log(minValue, minIndex)
        
        for(var i=0; i<this.colCount; i++){
          if(this.colHeightArray[i]<minValue){
            minValue = this.colHeightArray[i]
            minIndex = i
          }
        }
        console.log(minValue, minIndex)
        $node.css({
          left: minIndex * this.imgWidth,
          top: minValue
        })
        this.colHeightArray[minIndex] += $node.outerHeight(true)
      }
      
    }
    waterfall.init() */

    var colCount
    var imgWidth = $('.waterfall img').outerWidth(true)
    var colHeightArray = []
    colCount = Math.floor(($('.waterfall').width()/imgWidth))
    console.log(colCount)
    for(var i=0; i<colCount; i++){
        colHeightArray[i] = 0
    }
    $('.waterfall img').on('load', function(){
        var minvalue = colHeightArray[0]
        var minIndex = 0
        for(var i=0; i<colCount; i++){
            if(colHeightArray[i]<minvalue){
                minvalue = colHeightArray[i]
                minIndex = i
            }
        }
        $(this).css({
            left: minIndex * imgWidth,
            top: minvalue
        })
        colHeightArray[minIndex] += $(this).outerHeight(true)
    })


    $(window).on('resize', function(){
        colHeightArray = []
        colCount = Math.floor(($('.waterfall').width()/imgWidth))
        console.log(colCount)
        for(var i=0; i<colCount; i++){
            colHeightArray[i] = 0
        }
        $('.waterfall img').each(function(){
            var minvalue = colHeightArray[0]
            var minIndex = 0
            for(var i=0; i<colCount; i++){
                if(colHeightArray[i]<minvalue){
                    minvalue = colHeightArray[i]
                    minIndex = i
                }
            }
            $(this).css({
                left: minIndex * imgWidth,
                top: minvalue
            })
            colHeightArray[minIndex] += $(this).outerHeight(true)
        })
    })

</script>
</html>
